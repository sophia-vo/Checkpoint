<!-- file_path: index.html -->
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Interactive Guide to Parkinson's Disease</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Open+Sans:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.164.1/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.164.1/examples/jsm/"
            }
        }
    </script>
</head>

<body>
    <div id="loader">
        <h1>Loading content...</h1>
        <div class="spinner"></div>
    </div>

    <main id="fullpage-container">
        <section id="title-page-main" class="section"> <!-- Renamed from title-page -->
            <div class="content-wrapper title-page-content-wrapper">
                <h1 class="masked-main-title">PRESS, RELEASE, REPEAT</h1>
                <!-- Subtitle and team name removed from here -->
            </div>
        </section>

        <section id="title-page-sub" class="section"> <!-- New section for subtitle and team name -->
            <div class="content-wrapper title-page-content-wrapper">
                <h1 class="title-page-subtitle-typed"></h1> <!-- Will be populated by typing effect -->
                <h2 class="title-page-teamname-typed"></h2> <!-- Will be populated by fade-in effect -->
            </div>
        </section>

        <section id="intro-page" class="section">
            <div class="three-column-layout">
                <div class="image-column">
                    <img src="images/doubtfire.jpg" alt="Image of Robin Williams, who had Parkinson's">
                    <img src="images/ali.jpg" alt="Image of Muhammad Ali, who had Parkinson's">
                </div>

                <div class="text-column">
                    <h2>A Deeper Look into Parkinson's</h2>
                    <p><em>What if the way you typed could tell a story about your brain health? Parkinson's Disease, a
                            condition affecting millions, often whispers its first signs in the subtle changes to our
                            everyday movements.</em></p>
                    <p>Every six minutes, someone in the United States is diagnosed with Parkinson's Disease. That's
                        over
                        90,000 people each year facing a future with this progressive neurological disorder. For many,
                        including beloved figures like Michael J. Fox and Muhammad Ali, the journey with Parkinson's is
                        a
                        public one, but for countless others, it's a personal battle fought with courage and resilience.
                        This project is inspired by the need to bring greater understanding to a condition that touches
                        so
                        many lives, often silently at first.</p>
                    <h3>Our Research Question</h3>
                    <p>How can interactive data visualizations make the complex motor symptoms of Parkinson's Disease,
                        particularly those detectable through fine motor tasks like hand movements and typing, more
                        tangible
                        and understandable for a general audience, thereby fostering empathy and awareness?</p>

                </div>

                <div class="image-column">
                    <img src="images/diamond.jpg" alt="Image of Neil Diamond, who has Parkinson's">
                    <img src="images/mcfly.jpg" alt="Image of Michael J. Fox, who has Parkinson's">
                </div>
            </div>
        </section>

        <section id="hand-viz-page" class="section">
            <div class="two-column-layout">
                <div class="column text-column">
                    <h2>Motor Symptoms & The Hand</h2>
                    <p>The symptoms you explore here – changes in hand function – are not just data points; they
                        translate into daily challenges. Difficulty with writing can make signing documents or writing
                        notes frustrating. Tremors or rigidity can make buttoning a shirt, using utensils, or holding a
                        cup a slow and arduous process, impacting independence. These seemingly small motor changes can
                        accumulate, affecting one's ability to perform daily activities.</p>

                    <h3>How to Use This Visualization</h3>
                    <ul>
                        <li><strong>Explore the Model:</strong> Use your mouse to rotate the 3D hand model. Zoom in and
                            out using your scroll wheel or pinch gestures.</li>
                        <li><strong>Hover for Info:</strong> Move your cursor over different parts of the hand (fingers,
                            palm, wrist). Highlighted areas will display a tooltip with information about how
                            Parkinson's can affect that specific part.</li>
                        <li><strong>What to Look For:</strong> Notice which areas are commonly impacted. Think about how
                            these specific effects (e.g., tremor in the thumb, rigidity in the wrist) might translate to
                            difficulties with daily tasks like writing or gripping objects.</li>
                    </ul>
                    <p style="margin-top: 15px;"><em>The way Parkinson's affects the hands gives us a glimpse into its
                            impact on fine motor control. But what about other everyday actions that require similar
                            precision, like typing? The rhythm of our keystrokes can also tell a subtle story. Let's
                            explore how these digital fingerprints can change, drawing upon our understanding of
                            Parkinson's medications.</em></p>
                </div>
                <div class="column viz-column">
                    <div id="loading-overlay"
                        style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); z-index: 10; justify-content: center; align-items: center; text-align: center; flex-direction: column;">
                        <div class="spinner"></div> <!-- Re-using global spinner style -->
                        <p style="margin-top: 10px; font-size: 1rem; color: #333;">Loading 3D Model...</p>
                    </div>
                    <div id="hand-container"></div>
                    <div id="hand-tooltip"></div> <!-- Tooltip for hand.js -->
                </div>
            </div>
        </section>

        <section id="pulse-viz-page" class="section">
            <div class="two-column-layout">
                <div class="column viz-column pulse-column-left">
                    <h2>Typing Rhythm & Medication</h2>
                    <p>The consistency of motor actions, like typing, can be altered by Parkinson's. This interactive
                        "pulse" demonstrates representative typing rhythms. Select a medication category to see how
                        treatment might influence these patterns. Below, a line chart visualizes Hold or Flight Times for a sequence of keystrokes.</p>
                    <div id="med-buttons">
                        <button class="med-btn" data-med="Levadopa">Levadopa</button>
                        <button class="med-btn" data-med="DA">DA</button>
                        <button class="med-btn" data-med="MAOB">MAOB</button>
                        <button class="med-btn" data-med="Other">Other</button>
                        <button class="med-btn" data-med="No Med">No Med</button>
                    </div>
                    <div id="tempo-control">
                        Tempo: <input type="range" id="tempo-slider" min="0.5" max="3" step="0.1" value="1">
                        <span id="tempo-value">1x</span>
                    </div>
                    <div id="button-viz-container">
                        <button id="big-button">PULSE</button>
                    </div>
                    <div id="pulse-info-box">
                        <p>Hold Time: <span id="pulse-hold-time">-</span> ms</p>
                        <p>Flight Time: <span id="pulse-flight-time">-</span> ms</p>
                    </div>

                    <div id="medication-line-chart-controls">
                        <div id="chart-metric-toggle">
                            <strong>Chart Metric:</strong>
                            <label><input type="radio" name="chartMetric" value="Hold" checked> Hold Time</label>
                            <label><input type="radio" name="chartMetric" value="Flight"> Flight Time</label>
                        </div>
                        <div id="chart-medication-toggles">
                            <strong>Show on Chart:</strong>
                            <!-- Medication toggles will be populated by typing.js -->
                        </div>
                    </div>

                    <div id="medication-line-chart-container">
                        <div id="chart-loading-overlay" class="chart-loader-class" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); z-index: 100; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                            <div class="spinner"></div>
                            <p style="margin-top: 10px; font-size: 0.9rem; color: #333;">Loading chart data...</p>
                        </div>
                        <!-- D3 line chart will be rendered here -->
                    </div>
                </div>
                <div class="column text-column pulse-column-right">
                    <h3>How to Use This Visualization</h3>
                    <ul>
                        <li><strong>Select Medication (for PULSE):</strong> Click on the medication buttons ("Levodopa," "DA," etc.)
                            to load representative typing rhythm data for the "PULSE" animation for individuals on different treatments, or those
                            with no medication. This draws from the Tappy Keystroke Dataset.</li>
                        <li><strong>Observe the PULSE:</strong> The large "PULSE" button will animate to simulate
                            keystrokes based on your selection.
                            <ul>
                                <li>The <strong>duration it stays lit</strong> represents "Hold Time" (how long a key is
                                    pressed).</li>
                                <li>The <strong>time between illuminations</strong> represents "Flight Time" (the delay
                                    between one key release and the next key press).</li>
                            </ul>
                        </li>
                        <li><strong>Adjust Tempo:</strong> Use the "Tempo" slider to speed up or slow down the
                            simulation. This can help you better perceive the rhythm.</li>
                        <li><strong>Information Box:</strong> The box below the pulse will display the Hold Time and
                            Flight Time values for the current simulated keystroke from your selection.</li>
                        <li><strong>Interpret the Line Chart:</strong>
                            <ul>
                                <li>The chart below the PULSE button displays either Hold Times or Flight Times for a sequence of keystrokes.
                                    Use the "Chart Metric" toggles to switch between them.</li>
                                <li>Use the "Show on Chart" checkboxes to select which medication lines are visible.</li>
                                <li>Each colored line represents a different medication category.</li>
                                <li>The <strong>X-axis</strong> shows the keystroke event index.</li>
                                <li>The <strong>Y-axis</strong> shows the selected metric (Hold Time or Flight Time) in milliseconds (ms).</li>
                                <li>When the "PULSE" button animates, a marker will appear on the chart highlighting the current data point for the active medication's line (if visible).</li>
                                <li>Observe how patterns (level, variability) differ across medications and metrics.</li>
                            </ul>
                        </li>
                        <li><strong>What to Look For:</strong> Pay attention to the consistency of the hold times and
                            flight times in the PULSE animation. Are they regular, or do they vary significantly? How does the rhythm change
                            when you select different medication categories for the PULSE? Compare this to the overall trends and variability visible in the line chart.
                        </li>
                    </ul>
                    <p style="margin-top: 15px;"><em>We've seen a simulation of how typing rhythms can differ. Now, you
                            have the chance to (simulatively) compare your own typing patterns against a representative
                            example from the Tappy dataset, illustrating how technology might one day help us understand
                            these nuances even better.</em></p>
                </div>
            </div>
        </section>

        <section id="quote-page" class="section">
            <div class="content-wrapper narrow-content">
                <blockquote class="large-quote">
                    "I have Parkinson's disease. I am not Parkinson's disease. My identity is not based on the illness,
                    but on who I am as a person. It is a part of my life, not the entirety of it."
                    <footer>— Michael J. Fox (paraphrased)</footer>
                </blockquote>
            </div>
        </section>

        <section id="typing-test-page" class="section">
            <div class="content-wrapper typing-test-wrapper">
                <h2>Analyze Your Typing Patterns</h2>
                <p>Changes in typing speed and accuracy can be a significant hurdle for those with Parkinson's who rely
                    on computers. Simple tasks like sending an email or navigating a smartphone may take longer and
                    require more effort. This interactive test allows you to explore these nuances.</p>
                <h3>How to Use This Visualization</h3>
                <ul>
                    <li><strong>Select a Comparison Persona:</strong> Use the dropdown menu to choose a de-identified
                        persona whose typing data (representing a pattern seen in some individuals with Parkinson's from
                        the Tappy dataset) will be compared against yours.</li>
                    <li><strong>Start Typing:</strong> Click the "Click to start" overlay. A sentence will appear. Type
                        the displayed sentence; your typing will appear over the prompt.</li>
                    <li><strong>View Real-time Chart:</strong> As you type, a line chart will plot your latency (time
                        between keystrokes) in one color, and the selected persona's latency in another.</li>
                    <li><strong>Interpret the Chart:</strong>
                        <ul>
                            <li>The <strong>X-axis</strong> shows the character index (which keystroke in the sequence).
                            </li>
                            <li>The <strong>Y-axis</strong> shows the latency in milliseconds (ms).</li>
                        </ul>
                    </li>
                    <li><strong>What to Look For:</strong> Compare your line to the persona's line. Is your average
                        latency generally higher or lower? Is your line smoother or more "spiky" (variable)?</li>
                    <li><strong>Reset:</strong> Click the "Reset" button to try again with a new sentence or a different
                        comparison persona.</li>
                </ul>

                <div id="options">
                    <select id="person-select">
                        <option value="5USOYSDCXB">Person 1, 76M</option>
                        <option value="8TEUUGQBYB">Person 2, 81M</option>
                        <option value="E0TBSMYHQI">Person 3, 68M</option>
                        <option value="I3U47MF5UF">Person 4, 69F</option>
                        <option value="IDZHIUK2W2">Person 5, 73F</option>
                        <option value="JHBOKKHOQW">Person 6, 77F</option>
                        <option value="LIOUUNGQ8Q">Person 7, 59M</option>
                        <option value="LSQWWDXEYO">Person 8, 65M</option>
                        <option value="QEYNMBJ8T0">Person 9, 77M</option>
                        <option value="SGT8K5GXG0">Person 10, 74M</option>
                        <option value="TL2XHTLK1T">Person 11, 70M</option>
                        <option value="UDCY90VKYN">Person 12, 78M</option>
                        <option value="V2SZVYXBOD">Person 13, 75F</option>
                        <option value="VCTVD6LMPK">Person 14, 83F</option>
                        <option value="WDNE1Q9EHT">Person 15, 75F</option>
                        <option value="XWAX2IHF3O">Person 16, 46F</option>
                    </select>
                    <button id="reset">Reset</button>
                </div>

                <div id="test-container">
                    <div id="blur-overlay">Click to start</div>
                    <div id="sentence"></div>
                    <input type="text" id="input" autocomplete="off" autocorrect="off" autocapitalize="off"
                        spellcheck="false" />
                </div>

                <div id="result"></div>
            </div>
        </section>

        <section id="conclusion-page" class="section">
            <div class="content-wrapper narrow-content">
                <h2>Key Takeaways & Conclusion</h2>
                <h3>One Clear, Memorable Message</h3>
                <p>Technology offers powerful new lenses to understand and potentially detect subtle changes in motor
                    function, highlighting that even everyday actions like typing can hold valuable insights into
                    neurological health.</p>
                <h3>Why Our Visualizations Demonstrate This</h3>
                <p>Our interactive hand model makes the physical impact of Parkinson's tangible, while the typing rhythm
                    simulation and analysis tool directly connect a common digital interaction to the underlying motor
                    control challenges. By allowing users to see, feel, and even contribute their own (simulated) data,
                    these visualizations powerfully illustrate how technology, using datasets like Tappy, can decode the
                    nuanced language of movement.</p>
                <h3>Call to Action: Learn More & Take Action</h3>
                <p>Empower yourself with knowledge. Explore the resources linked in the next section to learn more about
                    Parkinson's Disease, support research, or find help if you or a loved one are affected. Consider how
                    technology in your own life might be leveraged for health awareness and discuss any concerns about
                    motor symptoms with a healthcare professional. Early understanding and action can make a significant
                    difference.</p>
            </div>
        </section>

        <section id="resources-support-page" class="section">
            <div class="content-wrapper narrow-content">
                <h2>Resources and Support</h2>
                <h3>Links to Parkinson's Organizations</h3>
                <ul>
                    <li><strong>Parkinson's Foundation:</strong> <a href="https://www.parkinson.org" target="_blank"
                            rel="noopener noreferrer">www.parkinson.org</a> - Comprehensive information, resources, and
                        support for patients and families.</li>
                    <li><strong>The Michael J. Fox Foundation for Parkinson's Research:</strong> <a
                            href="https://www.michaeljfox.org" target="_blank"
                            rel="noopener noreferrer">www.michaeljfox.org</a> - Leading research initiatives and patient
                        advocacy.</li>
                    <li><strong>American Parkinson Disease Association (APDA):</strong> <a
                            href="https://www.apdaparkinson.org" target="_blank"
                            rel="noopener noreferrer">www.apdaparkinson.org</a> - Support, education, and research
                        programs.</li>
                </ul>
                <h3>Further Reading and Research</h3>
                <ul>
                    <li>Explore the "Understanding Parkinson's" section on the Parkinson's Foundation website.</li>
                    <li>Search for "keystroke dynamics Parkinson's disease" on Google Scholar or PubMed for research
                        articles.</li>
                    <li>Visit the National Institute of Neurological Disorders and Stroke (NINDS) Parkinson's Disease
                        Information Page.</li>
                    <li><strong>Tappy Keystroke Dataset on PhysioNet:</strong> For those interested in the source data:
                        <a href="https://physionet.org/content/tappy/1.0.0/" target="_blank"
                            rel="noopener noreferrer">https://physionet.org/content/tappy/1.0.0/</a>
                    </li>
                </ul>
                <h3>Support Resources for Patients and Families</h3>
                <ul>
                    <li><strong>Helplines:</strong> Many Parkinson's organizations offer toll-free helplines for
                        information and support.
                        <ul>
                            <li>Parkinson's Foundation Helpline: 1-800-4PD-INFO (473-4636)</li>
                        </ul>
                    </li>
                    <li><strong>Support Groups:</strong> Local and online support groups provide a valuable way to
                        connect with others affected by Parkinson's. Check the websites of the major organizations for
                        listings.</li>
                    <li><strong>Educational Materials:</strong> Brochures, webinars, and articles are widely available
                        from the organizations listed above.</li>
                </ul>
            </div>
        </section>



    </main>

    <!-- Navigation Arrows -->
    <button id="prev-section" class="nav-arrow prev-arrow"><</button>
            <button id="next-section" class="nav-arrow next-arrow">></button>

            <!-- Navigation Dots -->
            <div id="nav-dots-container"></div>

            <script src="https://d3js.org/d3.v7.min.js"></script>
            <script type="module" src="hand.js"></script>
            <script type="module" src="typing.js"></script>
            <script type="module" src="typing-test.js"></script>

            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    const sections = document.querySelectorAll('.section');
                    const prevArrow = document.getElementById('prev-section');
                    const nextArrow = document.getElementById('next-section');
                    const dotsContainer = document.getElementById('nav-dots-container');
                    const globalLoader = document.getElementById('loader');
                    let currentSectionIndex = 0;
                    let typeWriterTimeout1 = null;
                    // typeWriterTimeout2 is no longer needed for team name typing


                    function typeWriter(element, text, speed, callback) {
                        let i = 0;
                        element.innerHTML = ''; // Clear existing content

                        if (element.typeWriterTimeout) {
                            clearTimeout(element.typeWriterTimeout);
                        }

                        function type() {
                            if (i < text.length) {
                                element.innerHTML += text.charAt(i);
                                i++;
                                element.typeWriterTimeout = setTimeout(type, speed);
                            } else {
                                element.typeWriterTimeout = null;
                                if (callback) {
                                    callback();
                                }
                            }
                        }
                        type();
                    }


                    function initializeVisualization(section) {
                        if (section.id === 'hand-viz-page' && !section.dataset.handVizInitialized) {
                            if (typeof window.initializeHandVisualization === 'function') {
                                window.initializeHandVisualization();
                                section.dataset.handVizInitialized = 'true';
                            }
                        } else if (section.id === 'pulse-viz-page' && !section.dataset.pulseVizInitialized) {
                            if (typeof window.initializePulseVisualization === 'function') {
                                // Show chart loader when pulse viz is initialized
                                const chartLoader = document.getElementById('chart-loading-overlay');
                                if (chartLoader) chartLoader.style.display = 'flex';
                                
                                window.initializePulseVisualization();
                                section.dataset.pulseVizInitialized = 'true';
                            }
                        }
                    }

                    function showSection(newIndex, isSpecialTitleTransition = false) {
                        if (newIndex < 0 || newIndex >= sections.length) return;

                        const oldSectionIndex = currentSectionIndex;
                        const oldSection = sections[oldSectionIndex];
                        const newSection = sections[newIndex];

                        const titleMainId = 'title-page-main';
                        const titleSubId = 'title-page-sub';

                        // Determine if a "push" slide transition should be applied
                        let applyPushTransition = false;
                        if (oldSection && newSection && oldSectionIndex !== newIndex) {
                            const isBetweenTitleMainAndSub =
                                (oldSection.id === titleMainId && newSection.id === titleSubId) ||
                                (oldSection.id === titleSubId && newSection.id === titleMainId);

                            if (isBetweenTitleMainAndSub) {
                                applyPushTransition = false; // No push for title-main <-> title-sub
                            } else {
                                applyPushTransition = true;  // Push for all other transitions
                            }
                        }

                        // Clear previous animation states from old section if it's not the new one
                        if (oldSection && oldSection !== newSection) {
                            oldSection.classList.remove('active', 'prepare-slide-from-left', 'prepare-slide-from-right', 'slide-to-left', 'slide-to-right');
                        }
                        // Clear preparation classes from new section in case of rapid navigation
                        newSection.classList.remove('prepare-slide-from-left', 'prepare-slide-from-right', 'slide-to-left', 'slide-to-right');


                        if (applyPushTransition) {
                            // Prepare new section for push
                            if (newIndex > oldSectionIndex) { // Moving Forward
                                newSection.classList.add('prepare-slide-from-right');
                            } else { // Moving Backward
                                newSection.classList.add('prepare-slide-from-left');
                            }
                            newSection.style.visibility = 'visible'; // Make it part of layout for transition

                            // Force reflow for the new section's preparation
                            newSection.offsetWidth;

                            // Animate old section out
                            if (oldSection && oldSection !== newSection) {
                                oldSection.classList.remove('active');
                                if (newIndex > oldSectionIndex) {
                                    oldSection.classList.add('slide-to-left');
                                } else {
                                    oldSection.classList.add('slide-to-right');
                                }
                            }

                            // Animate new section in
                            newSection.classList.remove('prepare-slide-from-left', 'prepare-slide-from-right');
                            newSection.classList.add('active');

                        } else { // Non-push transition (e.g., title-main <-> title-sub, or initial load)
                            if (oldSection && oldSection !== newSection) {
                                oldSection.classList.remove('active');
                                // Special handling for title-main -> title-sub transition (main title slides up)
                                if (oldSection.id === titleMainId && newSection.id === titleSubId && isSpecialTitleTransition) {
                                    const titleMainText = oldSection.querySelector('.masked-main-title');
                                    if (titleMainText) {
                                        titleMainText.classList.add('slide-up-out');
                                        // Cleanup for the main title text slide-up is handled by a timeout later
                                    }
                                } else {
                                    // Standard fade out for other non-push transitions
                                    oldSection.style.opacity = '0';
                                    oldSection.style.visibility = 'hidden';
                                }
                                oldSection.style.transform = 'translateX(0)'; // Reset transform if it was ever pushed
                            }

                            // Activate new section (fade in by default via .active class)
                            newSection.classList.add('active');
                            newSection.style.transform = 'translateX(0)'; // Ensure centered
                            newSection.style.opacity = '1';
                            newSection.style.visibility = 'visible';
                        }

                        // Cleanup for the old section after its transition completes
                        if (oldSection && oldSection !== newSection) {
                            setTimeout(() => {
                                oldSection.classList.remove('slide-to-left', 'slide-to-right');
                                // If it was the special title slide-up, ensure final hidden state
                                if (oldSection.id === titleMainId && newSection.id === titleSubId && isSpecialTitleTransition) {
                                    oldSection.style.opacity = '0';
                                    oldSection.style.visibility = 'hidden';
                                    const titleMainText = oldSection.querySelector('.masked-main-title');
                                    if (titleMainText) titleMainText.classList.remove('slide-up-out');
                                } else if (!applyPushTransition) { // General non-push hide already done
                                    // oldSection.style.visibility = 'hidden'; // Already set
                                } else { // General push hide
                                    oldSection.style.visibility = 'hidden';
                                }
                            }, 600); // Match CSS transition duration
                        }


                        newSection.scrollTop = 0; // Scroll to top of new section
                        initializeVisualization(newSection);

                        // Handle typing and fade-in effect for title-page-sub
                        const isMovingFromMainToSub = oldSection && oldSection.id === titleMainId && newSection.id === titleSubId;
                        if (newSection.id === titleSubId) {
                            const subtitleElement = newSection.querySelector('.title-page-subtitle-typed');
                            const teamNameElement = newSection.querySelector('.title-page-teamname-typed');

                            subtitleElement.textContent = ''; // Clear previous text for subtitle
                            teamNameElement.textContent = ''; // Clear previous text for team name
                            teamNameElement.style.opacity = 0; // Set team name to transparent initially

                            const textToTypeSubtitle = "Decoding Parkinson’s Through Typing";
                            const teamNameFullText = "TEAM SEABORN";
                            const typingSpeed = 70;

                            // Delay typing start if transitioning from main title with slide-up
                            const startTypingDelay = (isMovingFromMainToSub && isSpecialTitleTransition) ? 300 : (oldSection ? 500 : 0);


                            clearTimeout(typeWriterTimeout1);

                            typeWriterTimeout1 = setTimeout(() => {
                                typeWriter(subtitleElement, textToTypeSubtitle, typingSpeed, () => {
                                    // Callback after subtitle typing is done
                                    teamNameElement.textContent = teamNameFullText; // Set team name text directly
                                    // Short delay before starting fade-in to ensure text is set and transition applies
                                    setTimeout(() => {
                                        teamNameElement.style.opacity = 1; // Fade in team name (CSS transition handles the animation)
                                    }, 50);
                                });
                            }, startTypingDelay);

                        } else if (oldSection && oldSection.id === titleSubId) { // Clear effects if navigating away from title-page-sub
                            const subtitleTyped = oldSection.querySelector('.title-page-subtitle-typed');
                            const teamNameTyped = oldSection.querySelector('.title-page-teamname-typed');
                            if (subtitleTyped && subtitleTyped.typeWriterTimeout) {
                                clearTimeout(subtitleTyped.typeWriterTimeout);
                                subtitleTyped.typeWriterTimeout = null;
                            }
                            if (subtitleTyped) subtitleTyped.textContent = '';
                            if (teamNameTyped) {
                                teamNameTyped.textContent = '';
                                teamNameTyped.style.opacity = 0; // Reset opacity
                            }
                        }


                        // Restore title-page-main if navigating back to it
                        if (newSection.id === titleMainId) {
                            const titleMainText = newSection.querySelector('.masked-main-title');
                            if (titleMainText) {
                                titleMainText.classList.remove('slide-up-out'); // Ensure it's not stuck in slide-up
                                titleMainText.style.transform = ''; // Reset any transform
                                titleMainText.style.opacity = ''; // Reset opacity
                            }
                        }

                        updateDots(newIndex);
                        updateArrowVisibility(newIndex);
                        currentSectionIndex = newIndex;
                        localStorage.setItem('currentSectionIndex', newIndex);
                    }


                    function updateDots(activeIndex) {
                        if (!dotsContainer) return;
                        const dots = dotsContainer.querySelectorAll('.nav-dot');
                        dots.forEach((dot, i) => {
                            if (i === activeIndex) {
                                dot.classList.add('active');
                            } else {
                                dot.classList.remove('active');
                            }
                        });
                    }

                    function updateArrowVisibility(index) {
                        if (!prevArrow || !nextArrow) return;
                        prevArrow.style.display = index === 0 ? 'none' : 'flex';
                        nextArrow.style.display = index === sections.length - 1 ? 'none' : 'flex';
                    }

                    function createDots() {
                        if (!dotsContainer) return;
                        dotsContainer.innerHTML = '';
                        sections.forEach((_, i) => {
                            const dot = document.createElement('div');
                            dot.classList.add('nav-dot');
                            dot.addEventListener('click', () => showSection(i, false)); // Clicking dot is not special title transition
                            dotsContainer.appendChild(dot);
                        });
                    }

                    if (prevArrow) {
                        prevArrow.addEventListener('click', () => {
                            if (currentSectionIndex > 0) {
                                showSection(currentSectionIndex - 1, false); // Moving back is not special title transition
                            }
                        });
                    }

                    if (nextArrow) {
                        nextArrow.addEventListener('click', () => {
                            const currentActiveSection = sections[currentSectionIndex];
                            const nextPotentialIndex = currentSectionIndex + 1;
                            let specialTransitionFlag = false;

                            // Special transition only for title-main -> title-sub via next arrow
                            if (currentActiveSection.id === 'title-page-main' && nextPotentialIndex < sections.length && sections[nextPotentialIndex].id === 'title-page-sub') {
                                specialTransitionFlag = true;
                            }

                            if (nextPotentialIndex < sections.length) {
                                showSection(nextPotentialIndex, specialTransitionFlag);
                            }
                        });
                    }


                    document.addEventListener('keydown', (event) => {
                        const activeElement = document.activeElement;
                        const isTypingInput = activeElement.tagName === 'INPUT' ||
                            activeElement.tagName === 'TEXTAREA' ||
                            activeElement.isContentEditable;

                        if (isTypingInput && (event.key === 'ArrowLeft' || event.key === 'ArrowRight')) {
                            // Allow arrow keys for input fields, especially the typing test
                            if (activeElement.closest('#typing-test-page')) return;
                        }


                        if (event.key === 'ArrowRight' || event.key === 'PageDown') {
                            if (!(isTypingInput && activeElement.closest('#typing-test-page'))) {
                                nextArrow.click(); event.preventDefault();
                            }
                        } else if (event.key === 'ArrowLeft' || event.key === 'PageUp') {
                            if (!(isTypingInput && activeElement.closest('#typing-test-page'))) {
                                prevArrow.click(); event.preventDefault();
                            }
                        }
                    });

                    currentSectionIndex = 0;
                    
                    if (sections.length > 0) {
                        createDots();
                        // For initial load, don't use special title transition logic, just standard fade-in
                        showSection(currentSectionIndex, false);
                    }

                    const activeSectionForLoader = sections[currentSectionIndex];
                    let hideGlobalLoader = true;
                    if (activeSectionForLoader) {
                        if (activeSectionForLoader.id === 'pulse-viz-page' && !activeSectionForLoader.dataset.pulseVizInitialized) {
                             // Pulse viz page might have its own loader (chart loader)
                             // but global loader should still hide once DOM is ready for that section's specific loaders.
                        }
                        // Hand viz has its own internal loader, global loader can hide.
                    }

                    if (globalLoader && hideGlobalLoader) {
                        // Add a small delay to ensure initial section setup/rendering before hiding loader
                        setTimeout(() => {
                            globalLoader.style.display = 'none';
                        }, 100);
                    }
                });
            </script>
</body>

</html>